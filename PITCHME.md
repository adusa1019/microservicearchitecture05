# 5章 モノリスの分割

---
### 免責
- 本文を大胆に要約して整理した
    - 議論のたたき台にしてほしい
    - みんな読んでるよね！！！
- 大事なところが足りないと思ったらコメントしてほしい

---
### 心構え
- サービスが大きくなるのは普通のこと
    - いつ分割を開始するかが問題
    - 総コスト = 分割コスト + 関連コスト 
- 小さな変更少しずつ
    - 間違いのコストを小さく

---
### 分割の進め方
1. 境界付けられたコンテクストの把握
1. コードベースの分割
1. その他の分割

+++
### どこから手をつけるか
- 変化の速度
- チーム構成
- セキュリティ
- 技術 ...

---
### DBの分割
- 多くの場合DBにおいて依存関係が複雑になる
- こんな記事が書かれるくらいには面倒
    - [マイクロサービスの最難関、どうするDB分割？](http://tech.nikkeibp.co.jp/it/atcl/watcher/14/334361/111400957/)(日経XTECH(旧ITPro) 2017/11/20公開)

+++
#### こんなときどうする？
1. 外部キー関係
1. 共有静的データ
1. 共有データ
1. 共有テーブル


---
### 一貫性に関する考察
#### 分散システムで取れる手段
- 結果整合性を受け入れる
- 分散トランザクションを採用する


#### 既存トランザクションの分解
1. 単一トランザクションが必須か
1. 分割を避けられないか
1. どのドメインにおくのが自然か
    - トランザクションの表す概念を考えてみる

---
### リモートデータベースアクセスに関する考察
#### こんなときどうする？
- レポーティング
- バックアップ

+++
#### 実現案
- API経由
- データポンプ

---
### 参考
- [マイクロサービスのデータを管理する](https://www.infoq.com/jp/news/2017/08/managing-data-in-microservices)
- [マイクロサービスのトレードオフ](https://postd.cc/microservice-trade-offs/)
- [サービス分割とデータ統合アーキテクチャに関する考察](https://qiita.com/yebihara/items/8a849f611e4a41cf47e4)
